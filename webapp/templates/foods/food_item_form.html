{% set is_new = food_item is none %}
{% set save_action = url_for('foods.add_food') if is_new else url_for('foods.edit_food', food_id=food_item.id) %}
{% set delete_action = url_for('foods.delete_food', food_id=food_item.id) %}
{% set form_class = 'food-item' ~ (' food-item-new' if is_new else '') %}
<form class="row g-1 mb-3 mb-lg-2 justify-content-end {{form_class}}" action="{{ save_action }}" method="post">
  <div class="col-3 col-lg">
    <input type="hidden" name="origin" value="{{ 'category' if selected_category else 'all' }}" />
    <input type="hidden" name="category_id" value="{{ category.id }}" />
    <input type="text" class="form-control form-control-sm" name="name" title="Name" value="{{ food_item.name or '' }}"
      autocomplete="off" required />
  </div>
  <div class="col-6 col-lg">
    <div class="row g-1">
      <div class="col-4">
        <input type="number" class="form-control form-control-sm" name="portion_grams" title="Portion size (g)"
          value="{{ food_item.portion_grams or '' }}" min="0" />
      </div>
      <div class="col-4">
        <input type="number" class="form-control form-control-sm" name="energy_per_100g" title="Energy per 100g (kcal)"
          value="{{ food_item.energy_per_100g or '' }}" min="0" />
      </div>
      <div class="col-4">
        <input type="number" class="form-control form-control-sm" name="energy_per_portion"
          title="Energy per portion (kcal)" value="{{ food_item.energy_per_portion or '' }}" min="0" />
      </div>
    </div>
  </div>
  <div class="col-3 col-lg">
    <div class="d-flex gap-1 justify-content-between">
      <input type="text" class="form-control form-control-sm" name="stock_amount" title="Stock"
        value="{{ food_item.stock_amount or '' }}" autocomplete="off">
      <input type="text" class="form-control form-control-sm" name="due_date" title="Date"
        value="{{ food_item.due_date or '' }}" autocomplete="off">
    </div>
  </div>
  <div class="col-auto d-block d-lg-none" style="width: 115px"></div>
  <div class="col">
    <input type="text" class="form-control form-control-sm" name="comment" title="Comment"
      value="{{ food_item.comment or '' }}" autocomplete="off">
  </div>
  <div class="col-auto" style="width: 115px">
    <div class="d-flex gap-1 h-100 align-items-center">
      <input type="submit" class="btn btn-sm btn-primary flex-grow-1 save-button" value="Save" title="Save" />
      <input type="reset" class="btn btn-sm btn-secondary flex-grow-1 reset-button" value="Reset" title="Reset" />
      <input type="submit" class="btn btn-sm btn-outline-danger flex-grow-1 delete-button"
        formaction="{{ delete_action }}" formmethod="post" value="Delete" title="Delete" />
      <div class="flex-grow-1 loading-indicator text-center">
        <div class="spinner-border spinner-border-sm text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>
  </div>
</form>